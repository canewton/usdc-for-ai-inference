PR Testing

# Codelab Circle Project

Tech Stack

- Nextjs (React) w/ app router
- shadcn/ui
- Tailwind
- pnpm

## Setting up your local development environment

To set up your development environment for the Codelab Circle project, follow these steps:

1. **Install Git**:

   - Download and install Git from [git-scm.com](https://git-scm.com/).
   - Follow the installation instructions for your operating system.

2. **Install Node.js**:

   - Download and install Node.js from [nodejs.org](https://nodejs.org/).
   - Ensure you install the LTS version for better stability.

3. **Verify npm Installation**:

   - After installing Node.js, verify that `npm` is installed by running:
     ```bash
     npm -v
     ```
   - If `npm` is not installed, you can install it separately by following the instructions on the [npm website](https://www.npmjs.com/get-npm).

4. **Install pnpm**:

   - After confirming that `npm` is installed, open your terminal and run the following command to install `pnpm` globally:
     ```bash
     npm install -g pnpm
     ```

5. **Clone the Repository**:

   - Use Git to clone the repository to your local machine:
     ```bash
     git clone https://github.com/Codelab-Davis/circle.git
     ```

6. **Navigate to the Project Directory**:

   - Change into the project directory:
     ```bash
     cd circle
     ```
   - Open the project in your code editor (VSCode etc)

7. **Install Dependencies**:

   - Run the following command to install the project dependencies:
     ```bash
     pnpm install
     ```

8. **Rename `.env.example` to `.env.local` and update the following**:

   ```
  # Supabase configuration (https://app.supabase.com/project/_/settings/api)
  NEXT_PUBLIC_SUPABASE_URL=
  NEXT_PUBLIC_SUPABASE_ANON_KEY=
  
  # Treasury Wallet configuration
  NEXT_PUBLIC_TREASURY_WALLET_ID=<leave blank>
  NEXT_PUBLIC_TREASURY_WALLET_ADDRESS=<leave blank>
  
  # Circle API configuration (https://console.circle.com/apikeys)
  CIRCLE_API_KEY=
  CIRCLE_ENTITY_SECRET=
  CIRCLE_BLOCKCHAIN=ARB-SEPOLIA
  
  # Replicate (text-to-image) Key
  REPLICATE_API_TOKEN=
  
  # Openai (text-to-text) Key
  OPENAI_API_KEY=
  
  # Meshy (text-to-3d asset) configuration
  MESHY_BASE_URL=https://api.meshy.ai/openapi/v1/image-to-3d
  MESHY_API_KEY=
  
  #Novita.ai (image-to-video) Key
  NOVITA_API_KEY=
  
  # Admin credentials
  ADMIN_PASSWORD=
  ADMIN_USERNAME=
  
  USER_AI_GENERATION_LIMIT=50
  ```
   - `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY` can be found in [your Supabase project's API settings](https://app.supabase.com/project/_/settings/api).

   - `CIRCLE_API_KEY` can be found in the [API Keys](https://console.circle.com/api-keys) section of Circle's console, while `CIRCLE_ENTITY_SECRET` must be shared, or rotated [here](https://console.circle.com/wallets/dev/configurator/entity-secret) in case it's lost.

   - `REPLICATE_API_TOKEN` can be found in the [API Section](https://replicate.com/black-forest-labs/flux-schnell/api) of the Black Forest Labs Model

   - `OPENAI_API_KEY` can be found in the [Settings](https://platform.openai.com/settings) of your OpenAI account (Settings > API keys).

   - `MESHY_API_KEY` can be found in the [API Section](https://www.meshy.ai/settings/api) of your Meshy account

   - `NOVITA_API_KEY` can be found in the [Settings](https://novita.ai/settings/key-management) of your Novita account (Settings > API keys)

   - `CIRCLE_BLOCKCHAIN` is reccommended to be left as ARB-SEPOLIA. This is the blockchain network the website will be deployed to.

   - `ADMIN_USERNAME` and `ADMIN_PASSWORD` is the username and password for the admin user that can view website usage data and treasury wallet transactions

   - `USER_AI_GENERATION_LIMIT` is the amount of AI generations the user is able to perform for the demo

   Leave the follwing vars blank. These variables will be automatically generated by the generate-wallet.mjs script in step 3:

   - `NEXT_PUBLIC_TREASURY_WALLET_ID` and `NEXT_PUBLIC_TREASURY_WALLET_ADDRESS` can be left blank. This is the wallet is used to collect money from users interacting with the ai models.

9. **Create a new project on [Supabase](https://app.supabase.com)**

. Set up authentication:
   - Go to Authentication > Providers
   - Enable Email provider
   - Disable "Confirm Email" to allow immediate sign-ins

10. **Link your local project to your Supabase cloud project and push the database schema**:
   ```bash
   # Install Supabase CLI if you haven't already
   npm install supabase --save-dev

   # Link to your remote project - you'll need your project ID and database password
   npx supabase link --project-ref <project-id>

   # Push the database schema
   npx supabase db push
   ```
   > Note: You can find your project ID in your Supabase project settings under Project Settings > General

11. **Run the generate-wallet.mjs script to craete the agent wallet and updated the environment variables**:

   ```bash
   pnpm run generate-treasury-wallet
   ```

12. **Allow for live wallet balance updates**
  - Deploy the wallet-transactions edge function
    ```bash
    npx supabase functions deploy wallet-transactions --project-ref <project-id>
    ```
  - Go into the created edge function in Supabase https://supabase.com/dashboard/project/_/functions (Edge Functions tab on the Supabase project sidebar)
  - Go to the Details tab and disable the `Enforce JWT Verification` option and save
  - Copy the edge funtion endpoint url on the same page
  - Go to [webhooks](https://console.circle.com/webhooks) in the Circle console
  - Press the 'Add a webhook' button and paste the copied url in the corresponding field to add a webhook
  - Go back to the Edge Functions tab in the Supabase project and click on the `Secrets` option on the left sidebar
  - Add the following secrets that have the same value as the .env.local file: `CIRCLE_API_KEY` and `CIRCLE_ENTITY_SECRET`

13. **Create Supabase Storage Buckets**
  - Navigate to `Buckets` on the left sidebar of a supabase project
  - Add the following buckets and mark each bucket as public when prompted: user-images, user-3d, video-prompts, video-gen, and 3d-prompts
  - Navigate to `Policies` on the left sidebar of the Buckets page
  - Create a policy under storage.objects called 'Allow all upload, update, and delete', put `ALL` besides the 'Allowed operation' field, put `true` besides the 'USING expression' field, and save

13. **Run the Development Server**:

   - Start the development server with:
     ```bash
     pnpm dev
     ```
   - Open your browser and navigate to `http://localhost:3000` to view the application.

14. **Code Changes**:

   - You can now make changes to the code. The development server will automatically reload the application when you save your changes.

## Contributing

- **Never push directly to the main branch.**

Any time you want to work on a new feature, ticket, bug fix, etc., follow these steps:

1. Checkout the main branch:

   ```bash
   git checkout main
   ```

2. Pull the latest changes:

   ```bash
   git pull
   ```

3. Create a new branch from main called `[feature-name]`:

   ```bash
   git checkout -b feature-name
   ```

4. Do your work locally, then commit and push your changes:

   ```bash
   git add .
   git commit -m "Your commit message"
   git push -u origin feature-name
   ```

5. On GitHub, click the button to create a Pull Request (PR) from your branch and create the PR.

6. Keep contributing to this branch/PR and pushing your changes.

7. If you're done and GitHub Actions tests pass:

   - Go to the Slack channel and request a PR review from at least one other developer.
   - If the PR is approved, you can merge it into the main branch.

8. Vercel will automatically create preview deployments with a URL for each PR, which will be added as a comment on the PR. You can share this preview deployment with other developers and/or the client during the PR approval process.

9. Finally, locally checkout back to main and pull to ensure you're up to date:
   ```bash
   git checkout main
   git pull
   ```

## Tech Stack Crash Course

### Next.js

Next.js is a React framework that provides features such as server-side rendering and generating static websites.

Key features:

- **File-based Routing**: Next.js uses a file-system based router built on the concept of pages.

  - Pages are associated with a route based on their file name. For example, `pages/about.js` is mapped to `/about`.
  - In the App Router (which we're using), you create routes by adding folders to the `app` directory. The UI for each route is defined by a `page.js` file inside the folder.

- **Server-Side Rendering (SSR)**: Next.js can render React components on the server before sending them to the client.

- **API Routes**: Next.js allows you to create API endpoints as Node.js serverless functions.

Usage example:

```
// app/page.tsx
export default function Home() {
  return <h1>Welcome to Next.js!</h1>
}
```

### shadcn/ui

shadcn/ui is a collection of re-usable components built using Radix UI and Tailwind CSS.

Key features:

- Pre-built, accessible components
- Customizable with Tailwind CSS
- Copy and paste the components you need

Usage:

1. Add components as needed:

```
pnpm dlx shadcn@latest add button
```

2. Use the component in your code:

```
import { Button } from "@/components/ui/button"

export default function Home() {
  return <Button>Click me</Button>
}
```

### Tailwind CSS

Tailwind CSS is a utility-first CSS framework that allows you to rapidly build custom user interfaces.

Key features:

- Utility classes for styling
- Highly customizable
- Responsive design out of the box

Usage example:

```
<div className="p-4 m-2 bg-blue-500 text-white rounded-lg shadow-md hover:bg-blue-600">
  This is a Tailwind styled div
</div>
```

### pnpm

pnpm is a fast, disk space efficient package manager that uses a content-addressable filesystem to store all files from all modules on disk.

Key commands:

- Install dependencies: `pnpm install`
- Add a dependency: `pnpm add [package-name]`

Example usage:

```
# Install project dependencies
pnpm install

# Add a new package
pnpm add react-icons

# Run the development server
pnpm dev

# Build the project
pnpm build
```

For more detailed information on each technology, refer to their official documentation:

- [Next.js Documentation](https://nextjs.org/docs)
- [shadcn/ui Documentation](https://ui.shadcn.com/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [pnpm Documentation](https://pnpm.io/)
